# Draweråˆ°Modalè½¬æ¢é¡¹ç›®æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å°†æ‰€æœ‰çš„Ant Design Drawerç»„ä»¶ç»Ÿä¸€æ›¿æ¢ä¸ºModalç»„ä»¶ï¼Œä»¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œä¸€è‡´çš„äº¤äº’æ¨¡å¼ã€‚

## è½¬æ¢è¿›åº¦

### âœ… å·²å®Œæˆçš„ç»„ä»¶

#### 1. è´¦æˆ·ç®¡ç†æ¨¡å—

- **AccountFormModal** âœ… å®Œæˆ

  - æ–‡ä»¶è·¯å¾„: `src/app/system/accounts/components/account-form-modal.tsx`
  - åŠŸèƒ½: è´¦æˆ·æ–°å¢/ç¼–è¾‘è¡¨å•
  - ç‰¹ç‚¹: æ”¯æŒè§’è‰²å¤šé€‰ã€çŠ¶æ€ç®¡ç†
  - å®½åº¦: 600px

- **AccountPasswordModal** âœ… å®Œæˆ
  - æ–‡ä»¶è·¯å¾„: `src/app/system/accounts/components/account-password-modal.tsx`
  - åŠŸèƒ½: è´¦æˆ·å¯†ç ä¿®æ”¹
  - ç‰¹ç‚¹: å¯†ç å¼ºåº¦éªŒè¯ã€ç¡®è®¤å¯†ç éªŒè¯
  - å®½åº¦: 500px

#### 2. äº§å“ç®¡ç†æ¨¡å—

- **ProductFormModal** âœ… å®Œæˆ

  - æ–‡ä»¶è·¯å¾„: `src/app/system/products/components/product-form-modal.tsx`
  - åŠŸèƒ½: äº§å“æ–°å¢/ç¼–è¾‘è¡¨å•
  - ç‰¹ç‚¹: å¤æ‚è¡¨å•å¸ƒå±€ã€åˆ†ç±»é€‰æ‹©ã€è§„æ ¼é…ç½®
  - å®½åº¦: 800px

- **ProductDetailModal** âœ… å®Œæˆ
  - æ–‡ä»¶è·¯å¾„: `src/app/system/products/components/product-detail-modal.tsx`
  - åŠŸèƒ½: äº§å“è¯¦æƒ…å±•ç¤º
  - ç‰¹ç‚¹: åªè¯»å±•ç¤ºã€å›¾ç‰‡é¢„è§ˆã€æè¿°ä¿¡æ¯
  - å®½åº¦: 800px

#### 3. è§’è‰²ç®¡ç†æ¨¡å—

- **RoleFormModal** âœ… å®Œæˆ
  - æ–‡ä»¶è·¯å¾„: `src/app/system/roles/components/role-form-modal.tsx`
  - åŠŸèƒ½: è§’è‰²æ–°å¢/ç¼–è¾‘è¡¨å•
  - ç‰¹ç‚¹: æƒé™é…ç½®ã€çŠ¶æ€ç®¡ç†
  - å®½åº¦: 600px

#### 4. é€šç”¨ç»„ä»¶

- **ComponentUploadModal** âœ… å®Œæˆ
  - æ–‡ä»¶è·¯å¾„: `src/components/upload-modal.tsx`
  - åŠŸèƒ½: æ–‡ä»¶ä¸Šä¼ 
  - ç‰¹ç‚¹: æ‹–æ‹½ä¸Šä¼ ã€æ¨¡æ¿ä¸‹è½½ã€è¿›åº¦æç¤º
  - å®½åº¦: 520px

### ğŸ”„ è¿›è¡Œä¸­çš„ç»„ä»¶

#### 5. æƒé™ç®¡ç†æ¨¡å—

- **PermissionManageModal** ğŸ”„ å¾…å®Œæˆ
  - åŸæ–‡ä»¶: `src/app/system/roles/components/permission-manage-drawer.tsx`
  - åŠŸèƒ½: æƒé™è¯¦ç»†ç®¡ç†
  - ç‰¹ç‚¹: æƒé™æ ‘ã€æ‰¹é‡æ“ä½œ

### â³ å¾…è½¬æ¢çš„ç»„ä»¶

#### 6. åº—é“ºç®¡ç†æ¨¡å—

- **ShopFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/shops/components/shop-form-drawer.tsx`
  - åŠŸèƒ½: åº—é“ºæ–°å¢/ç¼–è¾‘è¡¨å•

#### 7. ä¾›åº”å•†ç®¡ç†æ¨¡å—

- **SupplierFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/suppliers/components/supplier-form-drawer.tsx`
  - åŠŸèƒ½: ä¾›åº”å•†æ–°å¢/ç¼–è¾‘è¡¨å•

#### 8. è´§ä»£ç®¡ç†æ¨¡å—

- **ForwarderFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/forwarders/components/forwarder-form-drawer.tsx`
  - åŠŸèƒ½: è´§ä»£æ–°å¢/ç¼–è¾‘è¡¨å•

#### 9. äº§å“åˆ†ç±»æ¨¡å—

- **CategoryFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/product-categories/components/category-form-drawer.tsx`
  - åŠŸèƒ½: äº§å“åˆ†ç±»æ–°å¢/ç¼–è¾‘è¡¨å•

#### 10. é‡‡è´­è®¢å•æ¨¡å—

- **PurchaseOrderFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/purchase-orders/components/purchase-order-form-drawer.tsx`
  - åŠŸèƒ½: é‡‡è´­è®¢å•æ–°å¢/ç¼–è¾‘è¡¨å•

#### 11. æˆå“åº“å­˜æ¨¡å—

- **InventoryFormModal** â³ å¾…è½¬æ¢
  - åŸæ–‡ä»¶: `src/app/system/finished-inventory/components/inventory-form-drawer.tsx`
  - åŠŸèƒ½: åº“å­˜æ–°å¢/ç¼–è¾‘è¡¨å•

## æŠ€æœ¯å®ç°

### æ ‡å‡†åŒ–Modalç»„ä»¶ç»“æ„

```typescript
const ComponentFormModal: React.FC<Props> = ({ open, entity, closeModal }) => {
  // 1. Hooks
  const { message } = App.useApp();
  const [submitting, { setFalse, setTrue }] = useBoolean(false);
  const [form] = Form.useForm();

  // 2. Handlers
  const handleSubmit = async () => {
    try {
      const formData = await form.validateFields();
      setTrue();

      const res = await formSubmit(entity, formData);
      if (get(res, 'data.code') === 0) {
        message.success('æ“ä½œæˆåŠŸ');
        closeModal(true);
      } else {
        message.error('æ“ä½œå¤±è´¥');
        setFalse();
      }
    } catch (error) {
      // é”™è¯¯å¤„ç†
    }
  };

  // 3. Effects
  useEffect(() => {
    if (open) {
      if (entity) {
        form.setFieldsValue(entity);
      } else {
        form.resetFields();
      }
    }
  }, [open, entity, form]);

  // 4. Modalé…ç½®
  const modalProps: ModalProps = {
    title: entity ? 'ç¼–è¾‘' : 'æ–°å»º',
    open: open,
    onOk: handleSubmit,
    onCancel: () => closeModal(),
    confirmLoading: submitting,
    destroyOnClose: true,
    maskClosable: false,
    width: 600,
    centered: true,
  };

  return (
    <Modal {...modalProps}>
      <Form form={form}>
        {/* è¡¨å•å†…å®¹ */}
      </Form>
    </Modal>
  );
};
```

### æ ¸å¿ƒæ”¹è¿›ç‚¹

1. **ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†**

   - ä½¿ç”¨`onOk`å’Œ`onCancel`æ›¿ä»£è‡ªå®šä¹‰footer
   - ç»Ÿä¸€çš„æäº¤é€»è¾‘å’Œé”™è¯¯å¤„ç†

2. **ä¼˜åŒ–çš„ç”Ÿå‘½å‘¨æœŸ**

   - ä½¿ç”¨`useEffect`æ›¿ä»£`afterOpenChange`
   - æ›´æ¸…æ™°çš„ç»„ä»¶çŠ¶æ€ç®¡ç†

3. **æ ‡å‡†åŒ–çš„Modalé…ç½®**

   - ç»Ÿä¸€çš„å®½åº¦è§„èŒƒ
   - ä¸€è‡´çš„äº¤äº’è¡Œä¸º

4. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**

   - å±…ä¸­æ˜¾ç¤º
   - é”®ç›˜æ“ä½œæ”¯æŒ
   - åŠ è½½çŠ¶æ€åé¦ˆ

5. **è§„èŒƒçš„ç±»å‹å¯¼å…¥**
   - ä¸¥æ ¼åˆ†ç¦»ç±»å‹å¯¼å…¥å’Œå€¼å¯¼å…¥
   - ä½¿ç”¨ç‹¬ç«‹çš„`import type`è¯­å¥
   - ç¬¦åˆé¡¹ç›®ä»£ç è§„èŒƒè¦æ±‚

## é¡µé¢æ›´æ–°æƒ…å†µ

### âœ… å·²æ›´æ–°çš„é¡µé¢

1. **è´¦æˆ·ç®¡ç†é¡µé¢** (`src/app/system/accounts/page.tsx`)

   - æ›´æ–°ç»„ä»¶å¼•ç”¨: `AccountFormDrawer` â†’ `AccountFormModal`
   - æ›´æ–°ç»„ä»¶å¼•ç”¨: `AccountPasswordDrawer` â†’ `AccountPasswordModal`
   - æ›´æ–°Props: `closeDrawer` â†’ `closeModal`

2. **äº§å“ç®¡ç†é¡µé¢** (`src/app/system/products/page.tsx`)
   - æ›´æ–°ç»„ä»¶å¼•ç”¨: `ProductFormDrawer` â†’ `ProductFormModal`
   - æ›´æ–°ç»„ä»¶å¼•ç”¨: `ProductDetailDrawer` â†’ `ProductDetailModal`
   - æ›´æ–°Props: `closeDrawer` â†’ `closeModal`

### â³ å¾…æ›´æ–°çš„é¡µé¢

1. è§’è‰²ç®¡ç†é¡µé¢ (`src/app/system/roles/page.tsx`)
2. åº—é“ºç®¡ç†é¡µé¢ (`src/app/system/shops/page.tsx`)
3. ä¾›åº”å•†ç®¡ç†é¡µé¢ (`src/app/system/suppliers/page.tsx`)
4. è´§ä»£ç®¡ç†é¡µé¢ (`src/app/system/forwarders/page.tsx`)
5. äº§å“åˆ†ç±»é¡µé¢ (`src/app/system/product-categories/page.tsx`)
6. é‡‡è´­è®¢å•é¡µé¢ (`src/app/system/purchase-orders/page.tsx`)
7. æˆå“åº“å­˜é¡µé¢ (`src/app/system/finished-inventory/page.tsx`)

## å·²åˆ é™¤çš„æ–‡ä»¶

### âœ… å·²åˆ é™¤çš„Drawerç»„ä»¶

1. `src/app/system/accounts/components/account-form-drawer.tsx`
2. `src/app/system/accounts/components/account-password-drawer.tsx`
3. `src/app/system/products/components/product-form-drawer.tsx`
4. `src/app/system/products/components/product-detail-drawer.tsx`
5. `src/components/upload-drawer.tsx`

## å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½å

- è¡¨å•Modal: `[module]-form-modal.tsx`
- è¯¦æƒ…Modal: `[module]-detail-modal.tsx`
- åŠŸèƒ½Modal: `[module]-[function]-modal.tsx`

### ç»„ä»¶å‘½å

- è¡¨å•Modal: `[Module]FormModal`
- è¯¦æƒ…Modal: `[Module]DetailModal`
- åŠŸèƒ½Modal: `[Module][Function]Modal`

### Propså‘½å

- æ˜¾ç¤ºçŠ¶æ€: `open`
- å…³é—­æ–¹æ³•: `closeModal`
- å®ä½“æ•°æ®: `entity`

## é…ç½®è§„èŒƒ

### Modalå®½åº¦è§„èŒƒ

- ç®€å•è¡¨å•: 520px (é»˜è®¤)
- æ ‡å‡†è¡¨å•: 600px
- å¤æ‚è¡¨å•: 800px
- è¯¦æƒ…å±•ç¤º: 800px

### é€šç”¨é…ç½®

```typescript
const modalProps: ModalProps = {
  title: 'æ ‡é¢˜',
  open: open,
  onOk: handleSubmit,
  onCancel: handleCancel,
  confirmLoading: submitting,
  destroyOnClose: true,
  maskClosable: false,
  centered: true,
};
```

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. **è¡¨å•æäº¤**

   - æ–°å»ºåŠŸèƒ½æ­£å¸¸
   - ç¼–è¾‘åŠŸèƒ½æ­£å¸¸
   - è¡¨å•éªŒè¯æ­£ç¡®

2. **äº¤äº’ä½“éªŒ**

   - æ¨¡æ€æ¡†æ‰“å¼€/å…³é—­æ­£å¸¸
   - é”®ç›˜æ“ä½œæ”¯æŒ (ESCå…³é—­ã€Enterç¡®è®¤)
   - åŠ è½½çŠ¶æ€åé¦ˆ

3. **é”™è¯¯å¤„ç†**
   - ç½‘ç»œé”™è¯¯å¤„ç†
   - è¡¨å•éªŒè¯é”™è¯¯å¤„ç†
   - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### æ€§èƒ½æµ‹è¯•

1. ç»„ä»¶æ¸²æŸ“æ€§èƒ½
2. å†…å­˜å ç”¨æƒ…å†µ
3. å¤§é‡æ•°æ®ä¸‹çš„è¡¨ç°

## åç»­å·¥ä½œè®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å¤©)

1. å®Œæˆå‰©ä½™çš„drawerç»„ä»¶è½¬æ¢
2. æ›´æ–°æ‰€æœ‰ç›¸å…³é¡µé¢çš„å¼•ç”¨
3. åˆ é™¤æ‰€æœ‰æ—§çš„drawerç»„ä»¶æ–‡ä»¶

### ä¸­æœŸç›®æ ‡ (1å‘¨)

1. å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### é•¿æœŸç›®æ ‡ (2å‘¨)

1. ä»£ç è´¨é‡ä¼˜åŒ–
2. æ–‡æ¡£å®Œå–„
3. æœ€ä½³å®è·µæ€»ç»“

## é£é™©è¯„ä¼°

### ä½é£é™©

- ç»„ä»¶ç»“æ„ç›¸ä¼¼ï¼Œè½¬æ¢ç›¸å¯¹ç®€å•
- ä¸šåŠ¡é€»è¾‘ä¿æŒä¸å˜
- å‘åå…¼å®¹æ€§è‰¯å¥½

### ä¸­ç­‰é£é™©

- éƒ¨åˆ†ç»„ä»¶å¯èƒ½æœ‰ç‰¹æ®Šçš„äº¤äº’é€»è¾‘
- éœ€è¦å¤§é‡çš„æ‰‹åŠ¨æµ‹è¯•
- å¯èƒ½å½±å“ç”¨æˆ·ä¹ æƒ¯

### é«˜é£é™©

- æ‰¹é‡ä¿®æ”¹å¯èƒ½å¼•å…¥æœªçŸ¥bug
- å¤æ‚è¡¨å•çš„éªŒè¯é€»è¾‘
- ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§

## æ€»ç»“

æœ¬æ¬¡draweråˆ°modalçš„è½¬æ¢é¡¹ç›®è¿›å±•é¡ºåˆ©ï¼Œå·²å®Œæˆçº¦50%çš„å·¥ä½œé‡ã€‚ä¸»è¦æˆæœåŒ…æ‹¬ï¼š

1. âœ… å»ºç«‹äº†æ ‡å‡†åŒ–çš„modalç»„ä»¶ç»“æ„
2. âœ… å®Œæˆäº†æ ¸å¿ƒæ¨¡å—çš„è½¬æ¢
3. âœ… æä¾›äº†å®Œæ•´çš„è½¬æ¢æŒ‡å—
4. âœ… ç¡®ä¿äº†ä»£ç è´¨é‡å’Œä¸€è‡´æ€§

æ¥ä¸‹æ¥å°†ç»§ç»­å®Œæˆå‰©ä½™ç»„ä»¶çš„è½¬æ¢ï¼Œå¹¶è¿›è¡Œå…¨é¢çš„æµ‹è¯•å’Œä¼˜åŒ–ã€‚

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ24æ—¥  
**é¡¹ç›®çŠ¶æ€**: è¿›è¡Œä¸­ (50% å®Œæˆ)  
**é¢„è®¡å®Œæˆæ—¶é—´**: 2024å¹´12æœˆ25æ—¥
