# æ™ºèƒ½æ•°æ®åº“åŒæ­¥ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ðŸš€ ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½æ•°æ®åº“åŒæ­¥ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºŽPrismaçš„å®Œæ•´æ•°æ®åº“çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿ï¼š

- **admin/123456** è´¦æˆ·100%å¯ç™»å½•
- åŠŸèƒ½è¿­ä»£æ—¶æ•°æ®åº“è‡ªåŠ¨åŒæ­¥
- çŽ°æœ‰æ•°æ®å®Œå…¨ä¿æŠ¤
- é›¶æ‰‹åŠ¨å¹²é¢„çš„è‡ªåŠ¨åŒ–æµç¨‹

## ðŸ“‹ æ ¸å¿ƒç»„ä»¶

### 1. æ™ºèƒ½Adminä¿®å¤å™¨ (smart-admin-fix.ts)

**ä½œç”¨**: è§£å†³adminç™»å½•é—®é¢˜ï¼Œç¡®ä¿admin/123456èƒ½å¤Ÿæ­£å¸¸ç™»å½•

**æ ¸å¿ƒåŠŸèƒ½**:

- å…¨é¢æ£€æµ‹adminè´¦æˆ·çŠ¶æ€ï¼ˆå­˜åœ¨æ€§ã€å¯†ç ã€è§’è‰²æƒé™ï¼‰
- è‡ªåŠ¨ä¿®å¤adminç”¨æˆ·å¹¶ç¡®ä¿å¯†ç ä¸º123456
- ç”Ÿæˆè¯¦ç»†çš„æ•°æ®åº“çŠ¶æ€æŠ¥å‘Š

### 2. æ™ºèƒ½æ•°æ®åº“åŒæ­¥å¼•æ“Ž (smart-db-sync.ts)

**ä½œç”¨**: å®Œæ•´çš„æ•°æ®åº“çŠ¶æ€æ£€æµ‹å’Œè‡ªåŠ¨ä¿®å¤æœºåˆ¶

**æ ¸å¿ƒåŠŸèƒ½**:

- SchemaçŠ¶æ€æ£€æµ‹ï¼ˆè¿ç§»çŠ¶æ€ã€å®¢æˆ·ç«¯ç”Ÿæˆç­‰ï¼‰
- æ•°æ®å®Œæ•´æ€§éªŒè¯ï¼ˆæ ¸å¿ƒè¡¨ã€ä¸šåŠ¡æ•°æ®ç»Ÿè®¡ï¼‰
- åŸºäºŽPrismaçš„è‡ªåŠ¨ä¿®å¤æœºåˆ¶

### 3. åŠŸèƒ½è¿­ä»£é›†æˆç³»ç»Ÿ (feature-iteration-sync.ts)

**ä½œç”¨**: æ”¯æŒæ–°åŠŸèƒ½çš„æ¸è¿›å¼æ•°æ®åº“æ›´æ–°å’Œè‡ªåŠ¨åŒ–æµç¨‹

**æ ¸å¿ƒåŠŸèƒ½**:

- åŠŸèƒ½é…ç½®ç®¡ç†
- æ¸è¿›å¼è¿ç§»æ‰§è¡Œ
- å›žæ»šæœºåˆ¶
- å®Œæ•´çš„è¿­ä»£æŠ¥å‘Š

## ðŸ› ï¸ å¯ç”¨å‘½ä»¤

### Adminè´¦æˆ·ç®¡ç†

```bash
# ä¿®å¤adminè´¦æˆ·ï¼ˆæ£€æµ‹+ä¿®å¤ï¼‰
npm run admin:fix

# ä»…éªŒè¯adminçŠ¶æ€
npm run admin:verify
```

### æ•°æ®åº“åŒæ­¥

```bash
# å®Œæ•´æ™ºèƒ½åŒæ­¥ï¼ˆæŽ¨èï¼‰
npm run db:smart-sync

# ä»…æ£€æŸ¥åŒæ­¥çŠ¶æ€
npm run db:sync:check

# ä¼ ç»Ÿæ–¹å¼
npm run db:migrate:production
npm run db:seed:production
```

### åŠŸèƒ½è¿­ä»£

```bash
# åº”ç”¨æ‰€æœ‰å¾…å¤„ç†åŠŸèƒ½
npm run feature:apply

# æ£€æŸ¥å¾…å¤„ç†åŠŸèƒ½
npm run feature:check
```

### å¥åº·æ£€æŸ¥

```bash
# å®Œæ•´å¥åº·æ£€æŸ¥
npm run health:check

# é™é»˜å¥åº·æ£€æŸ¥
npm run health:check:quiet
```

## ðŸ“– ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: è§£å†³adminç™»å½•é—®é¢˜

å½“admin/123456æ— æ³•ç™»å½•æ—¶ï¼š

```bash
# 1. è¿è¡Œæ™ºèƒ½ä¿®å¤
npm run admin:fix

# 2. æŸ¥çœ‹ä¿®å¤æŠ¥å‘Š
# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# - æ£€æµ‹adminç”¨æˆ·çŠ¶æ€
# - ä¿®å¤å¯†ç ä¸º123456
# - ç¡®ä¿è¶…çº§ç®¡ç†å‘˜è§’è‰²
# - ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
```

**è¾“å‡ºç¤ºä¾‹**:

```
ðŸš€ æ™ºèƒ½Adminè´¦æˆ·ä¿®å¤ç³»ç»Ÿå¯åŠ¨

ç›®æ ‡: ç¡®ä¿admin/123456èƒ½å¤Ÿæ­£å¸¸ç™»å½•

ðŸ” å¼€å§‹æ£€æµ‹adminè´¦æˆ·çŠ¶æ€...

âœ… adminç”¨æˆ·å­˜åœ¨
âŒ å¯†ç ä¸æ­£ç¡®
âœ… è´¦æˆ·çŠ¶æ€æ­£å¸¸
âœ… å·²åˆ†é…è§’è‰²: è¶…çº§ç®¡ç†å‘˜

ðŸ“Š æ£€æµ‹ç»“æžœ: éœ€è¦ä¿®å¤
ðŸ“‹ å‘çŽ°çš„é—®é¢˜:
   - å¯†ç ä¸æ­£ç¡®

ðŸ”§ å¼€å§‹ä¿®å¤adminè´¦æˆ·...

âœ… adminè´¦æˆ·å·²æ›´æ–°
âœ… è¶…çº§ç®¡ç†å‘˜è§’è‰²å·²åˆ†é…

ðŸ§ª éªŒè¯ä¿®å¤ç»“æžœ...

âœ… ä¿®å¤éªŒè¯æˆåŠŸï¼adminè´¦æˆ·çŠ¶æ€æ­£å¸¸

ðŸ“‹ ç™»å½•ä¿¡æ¯:
   ç”¨æˆ·å: admin
   å¯†ç : 123456

ðŸŽ‰ æ™ºèƒ½Adminä¿®å¤å®Œæˆï¼
```

### åœºæ™¯2: åŠŸèƒ½è¿­ä»£æ•°æ®åº“åŒæ­¥

å½“æŽ¨é€æ–°åŠŸèƒ½åˆ°ç”Ÿäº§çŽ¯å¢ƒæ—¶ï¼š

```bash
# 1. å®Œæ•´æ™ºèƒ½åŒæ­¥
npm run db:smart-sync

# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# - æ£€æµ‹SchemaçŠ¶æ€
# - åº”ç”¨å¾…å¤„ç†è¿ç§»
# - æ‰§è¡Œç§å­æ•°æ®
# - ä¿®å¤adminè´¦æˆ·
# - éªŒè¯æœ€ç»ˆçŠ¶æ€
```

**è¾“å‡ºç¤ºä¾‹**:

```
ðŸš€ æ™ºèƒ½æ•°æ®åº“åŒæ­¥ç³»ç»Ÿå¯åŠ¨

ç›®æ ‡: ç¡®ä¿æ•°æ®åº“çŠ¶æ€ä¸Žä»£ç åŒæ­¥ï¼Œä¿æŠ¤çŽ°æœ‰æ•°æ®

ðŸ” æ£€æµ‹æ•°æ®åº“SchemaçŠ¶æ€...

ðŸ“‹ è¿ç§»çŠ¶æ€:
Database is up to date, no pending migrations found.

âœ… Prisma SchemaéªŒè¯é€šè¿‡
âœ… Prismaå®¢æˆ·ç«¯å·²ç”Ÿæˆ

ðŸ“Š SchemaçŠ¶æ€: æœ€æ–°

ðŸ” æ£€æŸ¥æ•°æ®å®Œæ•´æ€§...

âœ… è¡¨ accounts å­˜åœ¨
âœ… è¡¨ roles å­˜åœ¨
âœ… è¡¨ permissions å­˜åœ¨
âœ… adminç”¨æˆ·å­˜åœ¨
âœ… å­˜åœ¨ 3 ä¸ªè§’è‰²
âœ… å­˜åœ¨ 156 ä¸ªæƒé™

ðŸ“ˆ ä¸šåŠ¡æ•°æ®ç»Ÿè®¡:
   åº—é“º: 5
   äº§å“: 127
   è®¢å•: 23

ðŸ“Š æ•°æ®å®Œæ•´æ€§: æ­£å¸¸

ðŸ“Š åŒæ­¥æŠ¥å‘Š

==================================================
ðŸ—„ï¸  SchemaçŠ¶æ€:
   çŠ¶æ€: âœ… æœ€æ–°

ðŸ“‹ æ•°æ®å®Œæ•´æ€§:
   adminç”¨æˆ·: âœ…
   è§’è‰²æ•°æ®: âœ…
   æƒé™æ•°æ®: âœ…
   è¡¨ç»“æž„: âœ…

ðŸ“ˆ ä¸šåŠ¡æ•°æ®:
   åº—é“º: 5
   äº§å“: 127
   è®¢å•: 23

==================================================
ðŸŽ¯ åŒæ­¥ç»“æžœ: âœ… æˆåŠŸ
ðŸ“ æ‘˜è¦: æ•°æ®åº“åŒæ­¥æˆåŠŸï¼Œæ‰€æœ‰ç³»ç»Ÿç»„ä»¶æ­£å¸¸è¿è¡Œ

ðŸŽ‰ æ•°æ®åº“åŒæ­¥å®Œæˆï¼ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªã€‚

ðŸ“‹ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è´¦æˆ·ç™»å½•:
   ç”¨æˆ·å: admin
   å¯†ç : 123456
```

### åœºæ™¯3: åˆ›å»ºæ–°åŠŸèƒ½é…ç½®

å½“éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼š

```bash
# 1. åˆ›å»ºåŠŸèƒ½é…ç½®ç›®å½•
mkdir -p feature-configs

# 2. åˆ›å»ºåŠŸèƒ½é…ç½®æ–‡ä»¶
cat > feature-configs/v2.1.0.json << 'EOF'
{
  "version": "v2.1.0",
  "description": "æ·»åŠ æ–°çš„äº§å“ç®¡ç†åŠŸèƒ½",
  "migrations": [
    {
      "id": "add_product_tags_table",
      "description": "åˆ›å»ºäº§å“æ ‡ç­¾è¡¨",
      "type": "schema",
      "prismaCommand": "npx prisma migrate deploy",
      "safety": "safe",
      "dependencies": []
    }
  ],
  "seedData": [
    {
      "id": "default_product_tags",
      "description": "åˆ›å»ºé»˜è®¤äº§å“æ ‡ç­¾",
      "type": "business_data",
      "data": {
        "tags": ["çƒ­é”€", "æ–°å“", "ç‰¹ä»·"]
      }
    }
  ],
  "rollbackPlan": [
    {
      "id": "rollback_product_tags",
      "description": "å›žæ»šäº§å“æ ‡ç­¾åŠŸèƒ½",
      "action": "DROP TABLE product_tags",
      "order": 1
    }
  ]
}
EOF

# 3. åº”ç”¨åŠŸèƒ½
npm run feature:apply
```

## ðŸ”§ é›†æˆåˆ°CI/CD

### GitHub Actionsé›†æˆ

æ›´æ–° `.github/workflows/deploy.yml`:

```yaml
- name: æ™ºèƒ½æ•°æ®åº“åŒæ­¥
  run: |
    npm run db:smart-sync

- name: åº”ç”¨åŠŸèƒ½è¿­ä»£
  run: |
    npm run feature:apply

- name: éªŒè¯adminè´¦æˆ·
  run: |
    npm run admin:verify

- name: å¥åº·æ£€æŸ¥
  run: |
    npm run health:check
```

### éƒ¨ç½²è„šæœ¬é›†æˆ

ç³»ç»Ÿå·²è‡ªåŠ¨é›†æˆåˆ° `scripts/deploy.sh` ä¸­ï¼š

```bash
# éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨è°ƒç”¨
npm run db:smart-sync
```

## ðŸ“Š ç›‘æŽ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥ç›‘æŽ§

```bash
# ç³»ç»Ÿå¥åº·æ£€æŸ¥
npm run health:check

# è¾“å‡ºåŒ…æ‹¬ï¼š
# - æ•°æ®åº“è¿žæŽ¥çŠ¶æ€
# - Prismaå®¢æˆ·ç«¯çŠ¶æ€
# - adminè´¦æˆ·çŠ¶æ€
# - å…³é”®æœåŠ¡çŠ¶æ€
# - ä¸šåŠ¡æ•°æ®ç»Ÿè®¡
```

### æ—¥å¿—ä½ç½®

- **åº”ç”¨æ—¥å¿—**: `logs/health-check.log`
- **éƒ¨ç½²æ—¥å¿—**: `scripts/deploy.sh` è¾“å‡º
- **å›žæ»šç‚¹**: `rollbacks/` ç›®å½•

## ðŸš¨ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

#### 1. adminæ— æ³•ç™»å½•

```bash
# è§£å†³æ–¹æ¡ˆ
npm run admin:fix

# å¦‚æžœä»ç„¶å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
# - æ•°æ®åº“è¿žæŽ¥
# - Prismaå®¢æˆ·ç«¯ç”Ÿæˆ
# - æƒé™è¡¨å®Œæ•´æ€§
```

#### 2. æ•°æ®åº“è¿ç§»å¤±è´¥

```bash
# æ£€æŸ¥è¿ç§»çŠ¶æ€
npx prisma migrate status

# é‡ç½®å¹¶é‡æ–°åŒæ­¥
npm run db:smart-sync

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
npm run health:check
```

#### 3. åŠŸèƒ½è¿­ä»£å¤±è´¥

```bash
# æ£€æŸ¥å¾…å¤„ç†åŠŸèƒ½
npm run feature:check

# æŸ¥çœ‹åŠŸèƒ½é…ç½®
ls -la feature-configs/

# æ£€æŸ¥å›žæ»šç‚¹
ls -la rollbacks/
```

### ç´§æ€¥æ¢å¤

å¦‚æžœç³»ç»Ÿå‡ºçŽ°ä¸¥é‡é—®é¢˜ï¼š

1. **åœæ­¢åº”ç”¨æœåŠ¡**
2. **æ£€æŸ¥æœ€è¿‘çš„å›žæ»šç‚¹**:
   ```bash
   ls -la rollbacks/
   ```
3. **æ‰§è¡Œç´§æ€¥ä¿®å¤**:
   ```bash
   npm run admin:fix
   npm run db:smart-sync
   ```
4. **éªŒè¯ç³»ç»ŸçŠ¶æ€**:
   ```bash
   npm run health:check
   ```

## ðŸŽ¯ æœ€ä½³å®žè·µ

### 1. å®šæœŸå¥åº·æ£€æŸ¥

```bash
# å»ºè®®æ¯å¤©è¿è¡Œ
npm run health:check
```

### 2. åŠŸèƒ½å‘å¸ƒå‰éªŒè¯

```bash
# å‘å¸ƒå‰æ£€æŸ¥
npm run db:sync:check
npm run admin:verify
npm run feature:check
```

### 3. ä¿æŒé…ç½®æ›´æ–°

- åŠæ—¶æ›´æ–°åŠŸèƒ½é…ç½®
- å®šæœŸæ¸…ç†æ—§çš„å›žæ»šç‚¹
- ç›‘æŽ§ç³»ç»Ÿæ—¥å¿—

### 4. å®‰å…¨è€ƒè™‘

- å®šæœŸæ›´æ”¹adminå¯†ç 
- ç›‘æŽ§å¼‚å¸¸ç™»å½•
- å®šæœŸå¤‡ä»½æ•°æ®åº“

## ðŸ“ž æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæŽ’æŸ¥ï¼š

1. è¿è¡Œ `npm run health:check` æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
2. æŸ¥çœ‹ `logs/health-check.log` æ—¥å¿—æ–‡ä»¶
3. æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥å’ŒPrismaå®¢æˆ·ç«¯
4. è¿è¡Œ `npm run admin:fix` ä¿®å¤adminè´¦æˆ·

---

**ç³»ç»Ÿç‰ˆæœ¬**: v1.0.0  
**æœ€åŽæ›´æ–°**: 2024å¹´12æœˆ24æ—¥  
**å…¼å®¹æ€§**: Node.js 18+, Prisma 5+, MySQL 8+
